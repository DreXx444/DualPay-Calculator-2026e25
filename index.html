<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="manifest" href="manifest.json">
    <title>DualPay 2026 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Montserrat:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; background: #05080f; min-height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; margin: 0; }
        .orb { position: absolute; width: 500px; height: 500px; border-radius: 50%; filter: blur(80px); z-index: 1; opacity: 0.4; animation: pulse 8s infinite alternate; }
        .orb-1 { background: #1e40af; top: -10%; left: -10%; }
        .orb-2 { background: #4c1d95; bottom: -10%; right: -10%; }
        @keyframes pulse { 0% { transform: scale(1); } 100% { transform: scale(1.2); } }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.1); width: 90%; max-width: 400px; border-radius: 3rem; position: relative; z-index: 10; padding: 2.5rem; color: white; text-align: center; }
        .input-box { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 1.5rem; padding: 1rem; text-align: left; margin-bottom: 1rem; }
        input { background: transparent; outline: none; width: 100%; color: white; border: none; font-size: 1.5rem; font-weight: 900; }
    </style>
</head>
<body>
    <div class="orb orb-1"></div><div class="orb orb-2"></div>
    <main class="glass-card">
        <canvas id="appIcon" width="90" height="90" class="rounded-[2rem] mx-auto mb-4 border border-white/20"></canvas>
        <h1 class="font-['Comfortaa'] text-2xl font-bold mb-6">DualPay 2026</h1>
        
        <div class="input-box">
            <label class="block text-[10px] text-blue-400 uppercase font-bold mb-1">Дължима сума</label>
            <div class="flex gap-2">
                <input type="number" id="due" placeholder="0.00">
                <select id="dueCur" class="bg-blue-600 rounded-lg text-xs p-1"><option>BGN</option><option>EUR</option></select>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-2 mb-6">
            <div class="input-box"><label class="text-[9px] text-slate-400 uppercase">Платено лв</label><input type="number" id="paidBGN" placeholder="0.00"></div>
            <div class="input-box"><label class="text-[9px] text-slate-400 uppercase">Платено €</label><input type="number" id="paidEUR" placeholder="0.00"></div>
        </div>

        <div id="resBox" class="hidden p-4 bg-white/5 rounded-2xl">
            <div id="resMain" class="text-4xl font-black mb-1">0.00 €</div>
            <div id="resSec" class="text-xs text-blue-400">0.00 лв</div>
        </div>
        <button onclick="location.reload()" class="mt-6 text-[9px] opacity-30 uppercase tracking-widest">Reset System</button>
    </main>

    <script>
        // Важно: sw.js (не .json!)
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

        const RATE = 1.95583;
        function initIcon() {
            const canvas = document.getElementById('appIcon');
            const ctx = canvas.getContext('2d');
            const g = ctx.createLinearGradient(0,0,90,90);
            g.addColorStop(0,'#3b82f6'); g.addColorStop(1,'#1d4ed8');
            ctx.fillStyle=g; ctx.fillRect(0,0,90,90);
            ctx.fillStyle='white'; ctx.font='bold 40px Arial'; ctx.fillText('€', 25, 55);
            const url = canvas.toDataURL();
            let l = document.createElement('link'); l.rel='icon'; l.href=url;
            document.head.appendChild(l);
        }

        function calc() {
            const d = parseFloat(document.getElementById('due').value) || 0;
            const cur = document.getElementById('dueCur').value;
            const pB = parseFloat(document.getElementById('paidBGN').value) || 0;
            const pE = parseFloat(document.getElementById('paidEUR').value) || 0;
            const dueBGN = cur === 'EUR' ? d * RATE : d;
            const paidBGN = pB + (pE * RATE);
            const changeBGN = paidBGN - dueBGN;
            const res = document.getElementById('resBox');
            if(d > 0) {
                res.classList.remove('hidden');
                document.getElementById('resMain').innerText = (changeBGN / RATE).toFixed(2) + ' €';
                document.getElementById('resSec').innerText = changeBGN.toFixed(2) + ' лв ресто';
            }
        }
        window.onload = initIcon;
        document.querySelectorAll('input, select').forEach(el => el.oninput = calc);
    </script>
</body>
</html>
